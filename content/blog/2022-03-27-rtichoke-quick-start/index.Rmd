---
title: A Simple Examle from Feature Engineering by Max Kuhn and Kjell Johnson
author: ''
date: '2022-05-19'
slug: []
categories: []
tags: []
output: 
  html_document: 
    keep_md: yes
---

Hi! Welcome to rtichoke blog!

This blog will be dedicated to the {rtichoke} package, which means that hopefully 


In order to make the package easier to use I plan to reproduce other people's code with rtichoke.

My first choice is to 

This book is dedicated to 

In the following example you can see how Box-Cox transformation improves the discrimination capability of the logistic regression model without using any additionalk information.


### The original ROC curve by the tidymodes


```{r message=FALSE, warning=FALSE}

library(caret)
library(tidymodels)
# library(pROC)
library(ggthemes)

# Create example data ----------------------------------------------------------

data(segmentationData)

segmentationData <- 
  segmentationData %>% 
  dplyr::select(EqSphereAreaCh1, PerimCh1, Class, Case) %>% 
  setNames(c("PredictorA", "PredictorB", "Class", "Case")) %>% 
  mutate(Class = factor(ifelse(Class == "PS", "One", "Two")))

example_train <- 
  segmentationData %>% 
  dplyr::filter(Case == "Train") %>% 
  dplyr::select(-Case)

example_test  <- 
  segmentationData %>% 
  dplyr::filter(Case == "Test") %>% 
  dplyr::select(-Case)

# Do analysis in natural units -------------------------------------------------

example_ctrl <- 
  trainControl(method = "none",
               classProbs = TRUE,
               summaryFunction = twoClassSummary)

natural_plot <- 
  ggplot(example_train) + 
  aes(x = PredictorA, y = PredictorB, color = Class) +
  geom_point(alpha = .3, cex = 1.5) + 
  theme(legend.position = c(.1, .8)) +
  scale_colour_tableau() + 
  ggtitle("(a)")

natural_terms <- train(Class ~ PredictorA + PredictorB,
                       data = example_train,
                       method = "glm",
                       metric = "ROC",
                       trControl = example_ctrl)

natural_dat <-
  example_test %>% 
  mutate(prob = predict(natural_terms, example_test, type = "prob")[,1]) %>% 
  roc_curve(Class, prob) %>% 
  mutate(Format = "Natural Units")


trans_terms <- train(Class ~ PredictorA + PredictorB,
                     data = example_train,
                     method = "glm",
                     preProc = "BoxCox",
                     metric = "ROC",
                     trControl = example_ctrl)

trans_dat <-
  example_test %>% 
  mutate(prob = predict(trans_terms, example_test, type = "prob")[,1]) %>% 
  roc_curve(Class, prob) %>% 
  mutate(Format = "Inverse Units") 

# https://bookdown.org/max/FES/a-simple-example.html#fig:intro-natural
# panel (a)
trans_plot <- 
  ggplot(example_train) + 
  aes(x = 1/PredictorA, y = 1/PredictorB, color = Class) +
  geom_point(alpha = .3, cex = 1.5) + 
  theme(legend.position = c(.1, .8)) +
  scale_colour_tableau() + 
  xlab("1/A") + ylab("1/B") + 
  ggtitle("(a)")

# Combine for plot -------------------------------------------------------------

both_dat <- 
  bind_rows(natural_dat, trans_dat) %>%
  mutate(Format = factor(Format, levels = c("Natural Units", "Inverse Units")))

# https://bookdown.org/max/FES/a-simple-example.html#fig:intro-natural
# panel (b)
trans_roc_plot <- 
  ggplot(both_dat) +
  geom_step(aes(x = 1 - specificity, y = sensitivity, color = Format)) + 
  coord_equal() + 
  xlab("False Positive Rate") + 
  ylab("True Positive Rate") + 
  theme_bw()+ 
  theme(legend.position = c(.8, .2)) + 
  scale_colour_manual(values = c("Natural Units" = "black", "Inverse Units" = "blue")) + 
  geom_abline(intercept = 0, slope = 1, col = "grey", lty = 2)  +   
  theme(panel.background = element_rect(fill = '#fff7f5', color = '#fff7f5'),
        plot.background = element_rect(fill = "#fff7f5"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        strip.background = element_blank())

trans_roc_plot

```

### ROC curve by rtichoke

```{r message=FALSE, warning=FALSE}
library(rtichoke)

create_roc_curve(
  probs = list(
    "Natural Units" = predict(natural_terms, 
                            example_test, type = "prob")[,1],
    "Inverse Units" = predict(trans_terms, 
                            example_test, type = "prob")[,1]
  ),
  reals = list(example_test$Class == "One"),
  size = 500, col_values = c("black", "blue")
) %>% 
plotly::layout(plot_bgcolor = "#fff7f5", 
               paper_bgcolor= "#fff7f5")

```

